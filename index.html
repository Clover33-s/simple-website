<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Data Entry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">

    <div class="flex flex-col min-h-screen">

        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-indigo-600">AI-Powered Data Entry</h1>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-6 lg:p-8">

            <!-- Database Connection -->
            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h2 class="text-2xl font-semibold mb-4">Database Connection</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="db-type" class="block text-sm font-medium text-gray-700">Database Type</label>
                        <select id="db-type" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="mysql">MySQL</option>
                            <option value="mongodb">MongoDB</option>
                        </select>
                    </div>
                    <div>
                        <label for="db-uri" class="block text-sm font-medium text-gray-700">Connection URI</label>
                        <input type="text" id="db-uri" placeholder="e.g., mongodb://localhost:27017/ or mysql+pymysql://user:password@host/db" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
                <button id="connect-db" class="mt-4 bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-indigo-700">Connect</button>
                <p id="db-status" class="mt-2 text-sm"></p>
            </div>

            <!-- Data Entry Form -->
            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h2 class="text-2xl font-semibold mb-4">Add New Company</h2>
                <form id="data-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="company-name" class="block text-sm font-medium text-gray-700">Company Name</label>
                        <input type="text" id="company-name" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="industry" class="block text-sm font-medium text-gray-700">Industry</label>
                        <input type="text" id="industry" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">Notes</label>
                        <input type="text" id="notes" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </form>
                <div class="mt-6 flex items-center space-x-4">
                    <button id="submit-data" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700">Add Entry</button>
                    <button id="clear-form" class="bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-gray-600">Clear</button>
                    <button id="voice-command" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-red-700">Voice Command</button>
                </div>
                 <p id="form-feedback" class="mt-4 text-sm font-medium"></p>
            </div>

            <!-- Data Table -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">Company Records</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company Name</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Industry</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>

        </main>

        <footer class="bg-white mt-auto">
            <div class="max-w-7xl mx-auto py-4 px-6 lg:px-8 text-center text-gray-500">
                <p>&copy; 2025 AI Data Entry. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const connectDbBtn = document.getElementById('connect-db');
            const dbTypeSelect = document.getElementById('db-type');
            const dbUriInput = document.getElementById('db-uri');
            const dbStatus = document.getElementById('db-status');

            const submitDataBtn = document.getElementById('submit-data');
            const companyNameInput = document.getElementById('company-name');
            const industryInput = document.getElementById('industry');
            const notesInput = document.getElementById('notes');
            const formFeedback = document.getElementById('form-feedback');
            const dataTableBody = document.getElementById('data-table-body');

            const clearFormBtn = document.getElementById('clear-form');
            const voiceCommandBtn = document.getElementById('voice-command');

            const API_URL = 'http://localhost:5001';

            // Connect to Database
            connectDbBtn.addEventListener('click', async () => {
                const type = dbTypeSelect.value;
                const uri = dbUriInput.value;

                if (!uri) {
                    dbStatus.textContent = 'Please provide a connection URI.';
                    dbStatus.className = 'mt-2 text-sm text-red-600';
                    return;
                }

                try {
                    const response = await fetch(`${API_URL}/connect`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type, uri }),
                    });
                    const result = await response.json();
                    if (response.ok) {
                        dbStatus.textContent = result.message;
                        dbStatus.className = 'mt-2 text-sm text-green-600';
                        fetchRecords();
                    } else {
                        dbStatus.textContent = `Error: ${result.message}`;
                        dbStatus.className = 'mt-2 text-sm text-red-600';
                    }
                } catch (error) {
                    dbStatus.textContent = `Connection error: ${error.message}`;
                    dbStatus.className = 'mt-2 text-sm text-red-600';
                }
            });

            // Fetch and Display Records
            async function fetchRecords() {
                try {
                    const response = await fetch(`${API_URL}/api/records`);
                    if (!response.ok) {
                        const result = await response.json();
                        formFeedback.textContent = `Error fetching records: ${result.message}`;
                        formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                        return;
                    }

                    const records = await response.json();
                    dataTableBody.innerHTML = ''; // Clear existing rows
                    records.forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">${record.company_name}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${record.industry}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${record.notes}</td>
                        `;
                        dataTableBody.appendChild(row);
                    });
                } catch (error) {
                    formFeedback.textContent = `Error fetching records: ${error.message}`;
                    formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                }
            }

            // Add New Entry
            submitDataBtn.addEventListener('click', async () => {
                const companyName = companyNameInput.value;
                const industry = industryInput.value;
                const notes = notesInput.value;

                if (!companyName || !industry) {
                    formFeedback.textContent = 'Company Name and Industry are required.';
                    formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                    return;
                }

                try {
                    const response = await fetch(`${API_URL}/api/records`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            company_name: companyName,
                            industry: industry,
                            notes: notes,
                        }),
                    });

                    const result = await response.json();
                    if (response.ok) {
                        formFeedback.textContent = 'Entry added successfully!';
                        formFeedback.className = 'mt-4 text-sm font-medium text-green-600';
                        clearForm();
                        fetchRecords();
                    } else {
                        formFeedback.textContent = `Error: ${result.message}`;
                        formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                    }
                } catch (error) {
                    formFeedback.textContent = `Request failed: ${error.message}`;
                    formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                }
            });

            // Clear Form
            function clearForm() {
                companyNameInput.value = '';
                industryInput.value = '';
                notesInput.value = '';
                formFeedback.textContent = '';
            }
            clearFormBtn.addEventListener('click', clearForm);

            // Voice Command Integration
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                const recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.interimResults = false;

                voiceCommandBtn.addEventListener('click', () => {
                    formFeedback.textContent = 'Listening...';
                    formFeedback.className = 'mt-4 text-sm font-medium text-blue-600';
                    recognition.start();
                });

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript.trim().toLowerCase();
                    formFeedback.textContent = `Recognized: "${transcript}"`;
                    handleVoiceCommand(transcript);
                };

                recognition.onerror = (event) => {
                    formFeedback.textContent = `Speech recognition error: ${event.error}`;
                    formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                };

                recognition.onend = () => {
                    // You can add logic here if needed when recognition ends.
                };

            } else {
                voiceCommandBtn.disabled = true;
                formFeedback.textContent = 'Voice recognition not supported in this browser.';
                formFeedback.className = 'mt-4 text-sm font-medium text-yellow-600';
            }

            function handleVoiceCommand(command) {
                const commands = {
                    'submit data': () => submitDataBtn.click(),
                    'clear form': () => clearFormBtn.click(),
                };

                if (commands[command]) {
                    commands[command]();
                    return;
                }

                // More complex commands for filling fields
                const setCompanyRegex = /set company to (.+)/;
                const setIndustryRegex = /set industry to (.+)/;
                const setNotesRegex = /set notes to (.+)/;

                let match;
                if ((match = command.match(setCompanyRegex))) {
                    companyNameInput.value = match[1];
                } else if ((match = command.match(setIndustryRegex))) {
                    industryInput.value = match[1];
                } else if ((match = command.match(setNotesRegex))) {
                    notesInput.value = match[1];
                } else {
                    formFeedback.textContent = `Unknown command: "${command}"`;
                    formFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                }
            }

        });
    </script>

</body>
</html>